<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <%- include('partials/header.ejs')%>

    <title>Library</title>
</head>

<body>
    <%- include('partials/nav.ejs', {page: 'storefront', user}) %>

    <h1>Library</h1>


    <% if(error) {%>
    <p style="color: red"><%= JSON.stringify(error)%></p>


    <% } else {%>
    <% for(let b of books){ %>

    <div class="card mb-3" style="width: 48%; display: inline-block;">
        <div class="row no-gutters">
            <div class="col-md-4">
                <img src="<%= b.data.image_url%>" class="card-img-top" style="height:12rem; object-fit: contain;">
            </div>
            <div class=" col-md-8">
                <div class="card-body">
                    <h5 class="card-title"><%= b.data.title %></h5>
                    <p class="card-text"><%= b.data.author %></p>
                    <div style="position: absolute; bottom:5%">
                        <form action="/b/book" method="post" style="display:inline">
                            <input type="hidden" name="bookId" value="<%= b.bookId %>">
                            <button type="submit" class="btn btn-primary">Details</button>
                        </form>
                        <form action="/b/add2interested" method="post" style="display:inline">
                            <input type="hidden" name="bookId" value="<%= b.bookId %>">
                            <button type="submit" class="btn btn-primary">Add to Interested</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <% } %>
    <% } %>

    <%- include('partials/scripts.ejs')%>
</body>

</html>

<!-- <script>
    document.getElementById("search").addEventListener('keyup', (e) => {
        console.log(document.getElementById("search").value)
    })
    document.getElementById("search").addEventListener('DOMContentLoaded', async function() {
            console.log("DOM", document.getElementById("search").value)
            const db = firebase.firestore();
            const collection = firebase.firestore().collection(Constants.COLL_BOOKS)
    
        const searchByName = async ({
              search = '',
              limit = 50,
              lastNameOfLastPerson = ''
            } = {}) => {
              const snapshot = await collection
                .where('keywords', 'array-contains', search.toLowerCase())
                .orderBy('name.last')
                .startAfter(lastNameOfLastPerson)
                .limit(limit)
                .get();
              return snapshot.docs.reduce((acc, doc) => {
                const name = doc.data().name;
                return acc.concat(`
                  <tr>
                    <td>${name.last}</td>
                    <td>${name.first}</td>
                    <td>${name.middle}</td>
                    <td>${name.suffix}</td>
                  </tr>`);
              }, '');
            };
    
            const textBoxSearch = document.querySelector('#textBoxSearch');
    
            const rowsPeople = document.querySelector('#rowsPeople');
            rowsPeople.innerHTML = await searchByName();
    
            textBoxSearch.addEventListener('keyup', async (e) => rowsPeople.innerHTML = await searchByName({search: e.target.value}));
    
            // async function lazyLoad() {
            //   const scrollIsAtTheBottom = (document.documentElement.scrollHeight - window.innerHeight) === window.scrollY; 
            //   if (scrollIsAtTheBottom) {
            //     const lastNameOfLastPerson = rowsPeople.lastChild.firstElementChild.textContent;
    
            //     rowsPeople.innerHTML += await searchByName({
            //       search: textBoxSearch.value,
            //       lastNameOfLastPerson: lastNameOfLastPerson
            //     });
            //   }
            // }
            window.addEventListener('scroll', lazyLoad);
          });
</script> -->